<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>McTool - Prüfungsverwaltung</title>

    <!--bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- jquerry-->
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script -->

     <!--font-awesome-icons-->   
    <script src="https://kit.fontawesome.com/3d2d5ca0b3.js" crossorigin="anonymous"></script>

    <!--css-stylesheet-->
    <link href="./verwaltung.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid" id="content-wrapper">
        <div class="row" id="top-bar-row">
            <h1>Prüfungsverwaltung</h1>
        </div>

        <div class="container main-content-wrapper">
            <div class="row full-width">
                <p class="subtitle ">Welche Prüfungsergebnisse möchten Sie sehen?</p>
                <div class="container filter-wrapper">
                  <div class="filter-col">
                    <label>Bitte wählen Sie eine Prüfung aus der Liste aus: </label>
                      <select id="examFilter" style="margin: 0 10px 0 10px">
                        <option selected disabled>Prüfung auswählen</option>
                        <!-- Options will be dynamically generated by JavaScript -->
                      </select>
                </div> 

                <div class="filter-col mt-2">
                    <label>oder suchen Sie nach der gewünschten Prüfungsbezeichnung: </label>
                    <input id="searchInput" style="margin: 0 10px 0 10px; width: 250px" type="text" placeholder="Prüfungsbezeichnung eingeben...">
                    <button id="searchButton" class="btn btn-light">Suchen</button>
                </div>
            </div>
            <!--Die Tabelle erstmal versteckt-->
            <div class="row table-content-row">
              <div class="table-wrapper">
                  <table class="table table-striped mt-5" id="resultsTable">
                      <thead>
                        <tr>
                          <th scope="col">Teilnehmer</th>
                          <th scope="col">Klasse</th>
                          <th scope="col">Ergebnis</th>
                        </tr>
                      </thead>
                      <tbody>
                        <!-- Rows will be inserted here by JavaScript -->
                      </tbody>
                    </table>
              </div>
        </div>

    </div>

    <!--bootstrap-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>

<script>
document.addEventListener("DOMContentLoaded", () => {
      const tableBody = document.querySelector("#resultsTable tbody");
      const examFilter = document.getElementById("examFilter");
      const searchButton = document.getElementById("searchButton");
      const searchInput = document.getElementById("searchInput");
  

    function populateTable(data) {
        tableBody.innerHTML = "";
        data.forEach(result => {
        const row = document.createElement("tr");

        const nameCell = document.createElement("td");
        nameCell.textContent = result.schuelernummer;
        row.appendChild(nameCell);

        const classCell = document.createElement("td");
        classCell.textContent = result.klasse;
        row.appendChild(classCell);

        const scoreCell = document.createElement("td");
        scoreCell.textContent = result.ergebnis;
        row.appendChild(scoreCell);

        tableBody.appendChild(row);
      });
    }

    //Holt alle Bezeichnungen aus Api und Listet sie auf
    async function loadPruefungBezeichnung() {
        try {
            const response = await fetch("http://127.0.0.1:8000/quizze/pruefung/bezeichnungen");
            const data = await response.json();
        
            if (data.status === "success") {
                examFilter.innerHTML = '<option value="">Bezeichnung wählen...</option>'; // Standardoption
                generateExamOptions(data.data)

            } else {
                console.error("Fehler beim Laden der Prüfungsbezeichnungen:", data);
            }
        } catch (error) {
            console.error("Fehler:", error);
        }
    }

    function generateExamOptions(uniqueExams) {
        uniqueExams.forEach(exam => {
            const option = document.createElement("option");
            option.value = exam;
            option.textContent = exam;
            examFilter.appendChild(option);
        });
    }

    // Lade Prüfungsergebnisse basierend auf der Auswahl
    async function filterByExam(pruefungBezeichnung) {
        try {
            const response = await fetch(`http://127.0.0.1:8000/quizze/pruefung/ergebnisse?pruefung_bezeichnung=${pruefungBezeichnung}`);
            const data = await response.json();
            if (response.ok) {
                populateTable(data.data.teilnehmer);
            } else {
                alert("Fehler beim Laden der Ergebnisse:", data);
            }
        } catch (error) {
            alert("Fehler:", error);
        }
    }

    //function filterBySearch(query) {
    //    const filteredResults = results.filter(result =>
    //        result.name.toLowerCase().includes(query.toLowerCase()) ||
    //        result.class.toLowerCase().includes(query.toLowerCase()) ||
    //        result.exam.toLowerCase().includes(query.toLowerCase())
    //    );
    //    populateTable(filteredResults);
    //}

    // Event-Listener für das Dropdown-Menü
    if (examFilter) {
        examFilter.addEventListener("change", (event) => {
            const selectedExam = event.target.value;
            if (selectedExam) {
                filterByExam(selectedExam);
            }
        });
    }
    
    // Event-Listener für den search Knopf
    if (searchButton) {
        searchButton.addEventListener("click", () => {
            const searchQuery = searchInput.value;
            filterByExam(searchQuery);
        });
    }

    // Event-Listener für den Search-input Textfeld
    if (searchInput) {
        searchInput.addEventListener("keyup", (event) => {
            if (event.key === "Enter") {
                const searchQuery = event.target.value;
                filterByExam(searchQuery);
            }
        });
    }

      //generateExamOptions();
      loadPruefungBezeichnung();
      //populateTable(results);
  });
</script>